<div class="container-fluid">

  <body class=" backgrountab">



    <div class="container-fluid ps-0 mt-4">
      <div class="custom-tabs">
        <button class="custom-tab" [ngClass]="{ 'active': activeTab === 'All Users' }"
          (click)="setActiveTab('All Users')">
          All Users <span class="custom-badge">{{ users.length }}</span>
        </button>
        <button class="custom-tab" [ngClass]="{ 'active': activeTab === 'Host' }" (click)="setActiveTab('Host')">
          Host
        </button>
        <button class="custom-tab" [ngClass]="{ 'active': activeTab === 'Guest' }" (click)="setActiveTab('Guest')">
          Guest
        </button>
        <button class="custom-tab" [ngClass]="{ 'active': activeTab === 'Application Review' }"
          (click)="setActiveTab('Application Review')">
          Application Review
        </button>
      </div>
    </div>

  </body>

  <div class="col-11 main-table card">
    <!-- Table header -->
    <div class="table-bar border-bottom d-flex justify-content-between align-items-center px-3 py-1">
      <h5 class="mb-0">{{ activeTab }}</h5>

      <div class="table-controls d-flex align-items-center gap-2">
        <!-- Search box -->
        <div class="position-relative w-100" style="max-width: 400px; margin: auto;">
          <div class="search-wrapper d-flex  position-relative">
            <img class="table-img me-3 mt-1" src="/img/searchicon.png" alt="Search" width="14" height="14" />
            <input class="input-search subfoont" type="text" placeholder="Search by name or email id" />
          </div>
        </div>

        <!-- Dropdown filter -->
        <div class="dropdown">
          <button class="btn dropdown-toggle custom-btn fontfamily" type="button" data-bs-toggle="dropdown">
            {{ currentFilter }}
          </button>
          <ul class="dropdown-menu dropdown-menu-end heading-dropdown fontfamily">
            <li><a class="dropdown-item" (click)="applyFilter('All')">All</a></li>
            <li><a class="dropdown-item" (click)="applyFilter('Active')">Active</a></li>
            <li><a class="dropdown-item" (click)="applyFilter('Inactive')">Inactive</a></li>
          </ul>
        </div>
      </div>
    </div>


    <!-- Table -->
    <div class="table-responsive custom-scroll-table"
      [ngClass]="{'application-review-table': activeTab === 'Application Review'}">
      <table class="table align-middle mb-0 border-1px custom-table">

        <!-- Table Head -->
        <thead class="custom-head">
          <tr>
            <!-- Default columns -->
            <ng-container *ngIf="activeTab !== 'Application Review'">
              <th scope="col">User</th>
              <th scope="col">Role</th>
              <th scope="col">Status</th>
              <th scope="col">Join Date</th>
              <th scope="col">Action</th>
            </ng-container>

            <!-- Application Review columns -->
            <ng-container *ngIf="activeTab === 'Application Review'">
              <th scope="col" class="text-start">User</th>
              <th scope="col" class="text-end">Application Date</th>
              <th scope="col" class="text-end">Action</th>
            </ng-container>

          </tr>
        </thead>

        <!-- Table Body -->
        <tbody>

          <!-- Default User Rows -->
          <ng-container *ngIf="activeTab !== 'Application Review'">
            <tr *ngFor="let user of filteredUsers">
              <td>
                <div class="d-flex align-items-center gap-2">
                  <img [src]="user.img || '/img/ProfileimgIcon.png'" class="rounded-circle" width="40" height="40" />
                  <div>
                    <div class="fontfamily">{{ user.name }}</div>
                    <div class="subfoont">{{ user.email }}</div>
                  </div>
                </div>
              </td>
              <td class="role"><img [src]="user.roleImg" class="me-1 role" /> {{ user.role }}</td>
              <td>
                <span class="status-badge" [ngClass]="{
              'active': user.status === 'Active',
              'inactive': user.status === 'Inactive'
            }">
                  <span class="dot"></span> {{ user.status }}
                </span>
              </td>
              <td>{{ user.joinDate }}</td>
              <td>
                <div class="dropdown dropstart">
                  <button class="btn three-dot-btn p-0 text-muted fs-4" type="button" data-bs-toggle="dropdown"><img
                      src="/img/Dots.png" alt=""></button>
                  <ul class="dropdown-menu shadow rounded-4 border-0 p-1 custom-dropdown">
                    <li>
                      <a class="dropdown-item fontfamily" data-bs-toggle="offcanvas" href="#hostDetails"
                        (click)="openOffcanvas(user, 'view')">View details</a>
                    </li>
                    <li>
                      <a class="dropdown-item fontfamily" data-bs-toggle="offcanvas" href="#hostDetails"
                        (click)="openOffcanvas(user, 'edit')">Edit</a>
                    </li>
                    <li>
                      <a class="dropdown-item text-danger fontfamily" href="#">Deactivate</a>
                    </li>
                  </ul>
                </div>
              </td>
            </tr>

            <!-- Empty row for default users -->
            <tr *ngIf="filteredUsers.length === 0">
              <td colspan="5" class="text-center py-3">No data available</td>
            </tr>
          </ng-container>



          <ng-container *ngIf="activeTab === 'Application Review'">
            <tr *ngFor="let user of hostApplications">
              <!-- User column -->
              <td class="user-col">
                <div class="d-flex align-items-center gap-2">
                  <img [src]="user.img" class="rounded-circle" width="40" height="40" />
                  <div class="user-info">
                    <div class="user-name fontfamily">{{ user.name }}</div>
                    <div class="user-email subfoont">{{ user.email }}</div>
                  </div>
                </div>
              </td>

              <!-- Application Date -->
              <td class="text-end application-date">{{ user.joinDate }}</td>

              <!-- Action -->
              <td class="text-end action-col">
                <div class="d-flex justify-content-end gap-2">
                  <!-- Eye icon opens offcanvas in VIEW mode -->
                  <img src="/img/eyeicon.png" alt="View" width="24" height="24" style="cursor:pointer;"
                    (click)="openOffcanvas(user, 'view')" data-bs-toggle="offcanvas" data-bs-target="#hostDetails" />
                </div>
              </td>
            </tr>

            <!-- Empty row if no hosts -->
            <tr *ngIf="hostApplications.length === 0">
              <td colspan="3" class="text-center py-3">No data available</td>
            </tr>
          </ng-container>


        </tbody>
      </table>
    </div>

  </div>



  <!-- Offcanvas -->
  <div class="offcanvas offcanvas-end host-offcanvas" tabindex="-1" id="hostDetails" aria-labelledby="hostDetailsLabel"
    (hidden.bs.offcanvas)="isMealDetailsView = false">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title d-flex align-items-center" id="hostDetailsLabel">
        <ng-container *ngIf="isMealDetailsView">
          <img src="/meal/backbtn.png" alt="Back" class="back-btn me-2" (click)="closeMealDetails()" />
        </ng-container>

        {{ getOffcanvasTitle() }}
      </h5>

      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"
        (click)="allClosed()"></button>
    </div>

    <div class="offcanvas-body" [ngClass]="getOffcanvasBodyClass()">

      <!-- Tabs -->
      <div class="container-fluid ps-0 mt-2 border-bottom-dotted" *ngIf="!isMealDetailsView">
        <div class="custom-tabs2">

          <!-- View Mode Tabs -->
          <ng-container *ngIf="mode === 'view' && offcanvasTab !== 'applicationReview'">
            <button class="custom-tab2 active">Overview</button>
            <button class="custom-tab2">Booking History</button>
          </ng-container>

          <!-- Edit Mode Tabs -->
          <ng-container *ngIf="mode === 'edit' || offcanvasTab === 'applicationReview'">

            <!-- Overview tab: always visible -->
            <button class="custom-tab2" [class.active]="
          (offcanvasTab === 'overview') || 
          (offcanvasTab === 'applicationReview' && appReviewSubTab === 'overview')
        " (click)="
          offcanvasTab === 'applicationReview' ? setAppReviewSubTab('overview') : setOffcanvasTab('overview')
        ">
              Overview
            </button>


            <!-- Upload Documents tab: only for Application Review -->
            <button *ngIf="offcanvasTab === 'applicationReview'" class="custom-tab2"
              [class.active]="appReviewSubTab === 'documents'" (click)="setAppReviewSubTab('documents')">
              Upload Documents
            </button>

            <!-- Listed Meals and Booking History: hide for Application Review -->
            <button *ngIf="offcanvasTab !== 'applicationReview'" class="custom-tab2"
              [class.active]="offcanvasTab === 'listedMeals'" (click)="setOffcanvasTab('listedMeals')">
              Listed Meals
            </button>

            <button *ngIf="offcanvasTab !== 'applicationReview'" class="custom-tab2"
              [class.active]="offcanvasTab === 'bookingHistory'" (click)="setOffcanvasTab('bookingHistory')">
              Booking History
            </button>

          </ng-container>

        </div>
      </div>


      <!-- User Header -->
      <!-- ✅ Show header only in overview -->
      <div *ngIf="offcanvasTab === 'overview'"
        class="user-header d-flex align-items-center mt-2 mb-2 border-bottom-dotted ">
        <img src="/img/ProfileimgIcon.png" class="rounded-circle me-3" alt="User">
        <div>
          <h6 class="mb-0 fw-semibold">{{ selectedUser?.name }}</h6>
          <small class="text-muted">{{ selectedUser?.email }}</small>
        </div>
        <span class="status-badge active ms-auto offstatus">
          <span class="dot"></span>{{ selectedUser?.status }}
        </span>
      </div>


      <!-- User Details -->
      <!-- User Details (only when NOT in Application Review) -->
      <div *ngIf="(mode === 'view' || offcanvasTab === 'overview') && offcanvasTab !== 'applicationReview'">

        <!-- User Details -->
        <div class="details-list">
          <!-- User Type -->
          <div class="detail-row user-type">
            <span class="label">User type</span>
            <span class="value">
              <span class="host-badge active off-active" [ngClass]="{ 'edit-mode': mode === 'edit' }">
                <img src="/img/food.png" alt="" style="margin-right:0.5rem; width:18px;">
                Host
              </span>
            </span>
          </div>

          <!-- First Name -->
          <div class="detail-row">
            <span class="label">First name</span>
            <span class="value">
              <!-- View mode -->
              <span *ngIf="mode === 'view'">{{ selectedUser?.firstName }}</span>

              <!-- Edit mode -->
              <div *ngIf="mode === 'edit'">
                <!-- If not editing yet: just show the pen -->
                <div *ngIf="!isFirstNameEditing" class="d-flex align-items-center">
                  <span>{{ selectedUser?.firstName }}</span>
                  <img src="/img/redpen.png" alt="edit" style="width:24px;height:22px;cursor:pointer;margin-left:10px;"
                    (click)="toggleFirstNameEdit()" />
                </div>

                <!-- If editing: show input -->
                <div *ngIf="isFirstNameEditing" class="input-with-icon d-flex align-items-center">
                  <input type="text" [(ngModel)]="selectedUser!.firstName"
                    class="form-control form-control-sm red-border me-2" placeholder="Enter first name" />
                </div>
              </div>
            </span>
          </div>


          <!-- Last Name -->
          <div class="detail-row">
            <span class="label">Last name</span>
            <span class="value">
              <!-- View mode -->
              <span *ngIf="mode === 'view'">{{ selectedUser?.lastName }}</span>

              <!-- Edit mode -->
              <div *ngIf="mode === 'edit'">
                <!-- If not editing yet -->
                <div *ngIf="!isLastNameEditing" class="d-flex align-items-center">
                  <span>{{ selectedUser?.lastName }}</span>
                  <img src="/img/redpen.png" alt="edit"
                    style="width:24px;height:22px;cursor:pointer;margin-left:10px; padding-bottom: .3;"
                    (click)="toggleLastNameEdit()" />
                </div>

                <!-- If editing -->
                <div *ngIf="isLastNameEditing" class="d-flex align-items-center">
                  <input type="text" [(ngModel)]="selectedUser!.lastName"
                    class="form-control form-control-sm me-2 red-border" placeholder="Enter last name" />
                </div>
              </div>
            </span>
          </div>


          <!-- Display Name -->
          <div class="detail-row">
            <span class="label">Display name</span>
            <span class="value">
              <!-- Always read-only, no input in edit mode -->
              <span>{{ selectedUser?.displayName }}</span>
            </span>
          </div>


          <!-- Gender -->
          <div class="detail-row">
            <span class="label">Gender</span>
            <span class="value">
              <!-- Always show as text, both in view & edit -->
              <span>{{ selectedUser?.gender }}</span>
            </span>
          </div>


          <!-- Email -->
          <div class="detail-row">
            <span class="label">Email</span>
            <span class="value">{{ selectedUser?.email }}</span>
          </div>

          <!-- Contact -->
          <div class="detail-row">
            <span class="label">Contact</span>
            <span class="value">{{ selectedUser?.contact }}</span>
          </div>

          <div class="detail-row">
            <span class="label">Country</span>
            <span class="value">{{ selectedUser?.country }}</span>
          </div>


          <div class="detail-row">
            <span class="label">Known languages</span>
            <span class="value">
              <span *ngFor="let lang of selectedUser?.knownLanguages" class="badge bg-dark me-1">{{ lang }}</span>
            </span>
          </div>
        </div>

       <div *ngIf="mode === 'edit' && (isFirstNameEditing || isLastNameEditing)" 
     class="review-actions mt-3">
  <button class="reject-btn" (click)="discardChanges()">Discard changes</button>
  <button class="save-approve-btn" (click)="saveUserDetails()">Save changes</button>
</div>




      </div>

      <div *ngIf="offcanvasTab === 'listedMeals' && !isMealDetailsView" class="mt-3">

        <div class="meal-item d-flex align-items-center mb-3 p-2 border meal-list">
          <!-- Meal Image -->
          <img src="/meal/meal1.png" alt="Meal"
            style="width:83px; height:83px; object-fit:cover; border-radius:8px; margin-right:10px;">

          <!-- Dish Info (Left side: Title + Subtext) -->
          <div class="flex-grow-1">
            <h6 class="mb-2 fw-semibold">Paneer Butter Masal</h6>
            <small class="text-muted">Dine-in • Tomorrow, Dinner</small>
            <div class="mt-1">
              <span class="status-badge active meal-size">Active</span>
            </div>
          </div>

          <!-- Right side: Button + Price -->
          <div class="d-flex flex-column align-items-end ms-3">
            <button class="btn custom-meal-btn" (click)="openMealDetails()">
              <img src="/meal/mealicon.png" alt=""> View Details
            </button>
            <div class="mb-0 meal-price1"><span class="meal-price1">₹250</span>
              <p class="meal-price">Per guest</p>
            </div>

          </div>
        </div>



      </div>


      <!-- Meal Details Page -->
      <div *ngIf="isMealDetailsView" class="container">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="card meal-card" style="">
              <div class="card-header bg-dark text-white mealhead" style="">
                <h6 class="mb-0">John Doe</h6>
              </div>
              <div class="card-body" style="">
                <img src="/meal/meal2.png" class="img-fluid mealfull" alt="Sample Image">
              </div>
            </div>
          </div>
        </div>
        <div class="meal-info container mt-3">
          <div class="meal-info-row">
            <span class="meal-label mealfont">Meal Name</span>
            <span class="meal-value">Paneer Butter Masala with Naan and Jeera Rice</span>
          </div>

          <div class="meal-info-row">
            <span class="meal-label mealfont">Meal Type</span>
            <span class="meal-value">Dine-in, Take-Away, Delivery</span>
          </div>

          <div class="meal-info-row">
            <span class="meal-label mealfont">Scheduled Time</span>
            <span class="meal-value">Tomorrow, Dinner</span>
          </div>

          <div class="meal-info-row">
            <span class="meal-label mealfont">Price Per Guest</span>
            <span class="meal-value">₹ 280</span>
          </div>

          <div class="meal-info-row border-bottom pb-2 mb-2">
            <span class="meal-label mealfont">Meal Description</span>
            <span class="meal-value ">
              Rich paneer butter masala served with freshly made naan and fragrant jeera rice.
              Perfect for lunch with family or friends.
            </span>
          </div>

        </div>


      </div>

      <!-- ✅ Application Review  -->

    <div *ngIf="offcanvasTab === 'applicationReview' && appReviewSubTab === 'overview'"
     class="app-review-overview-body">

  <div class="user-image">
    <img class="mt-3" src="/img/userimg.png" alt="User Image" style="width: 128px; height: 128px;" >
  </div>

  <div class="user-details">
    <div class="detail-row">
      <span class="label">First name</span>
      <span class="value">{{ selectedUser?.firstName }}</span>
    </div>
    <div class="detail-row">
      <span class="label">Last name</span>
      <span class="value">{{ selectedUser?.lastName }}</span>
    </div>
    <div class="detail-row">
      <span class="label">Gender</span>
      <span class="value">{{ selectedUser?.gender }}</span>
    </div>
    <div class="detail-row">
      <span class="label">Lorem</span>
      <span class="value">Lorem Ipsum</span>
    </div>
    <div class="detail-row">
      <span class="label">Lorem</span>
      <span class="value">Lorem Ipsum</span>
    </div>
    <div class="detail-row">
      <span class="label">Lorem</span>
      <span class="value">Lorem Ipsum</span>
    </div>
  </div>

  <!-- Buttons -->
  <div class="review-actions">
    <button class="reject-btn">Reject application</button>
    <button class="approve-btn">Approve application</button>
  </div>
</div>



      <!-- ======================= -->
      <!-- ✅ Application Review → Documents -->
      <!-- ======================= -->
      <div *ngIf="offcanvasTab === 'applicationReview' && appReviewSubTab === 'documents'" class="documents-body">
      <div class="documents-body">
    <!-- Aadhar Card -->
    <div class="doc-card" *ngIf="currentDoc === 1">
      <div class="doc-header"></div>
      <div class="doc-preview">
        <img src="/img/Adhar.png" alt="Aadhar Front" />
        <img src="/img/BackAdhar.png" alt="Aadhar Back" />
      </div>
      <div class="doc-footer">
        <span class="doc-index">Govt. ID&nbsp;&nbsp;1/2</span>
        <div class="nav-buttons">
  <div class="icon-btn" 
       (click)="prevDoc()" 
       [class.disabled]="currentDoc === 1">
    <img src="/sidebar/Preicon.png" alt="Previous">
  </div>
  <div class="icon-btn" (click)="nextDoc()">
    <img src="/sidebar/Next Icon.png" alt="Next">
  </div>
</div>

      </div>
    </div>

    <!-- PAN Card -->
    <div class="doc-card" *ngIf="currentDoc === 2">
      <div class="doc-header"></div>
      <div class="doc-preview">
        <img src="/img/Adhar.png" alt="PAN Front" />
        <img src="/img/BackAdhar.png" alt="PAN Back" />
      </div>
      <div class="doc-footer">
        <span class="doc-index">Govt. ID&nbsp;&nbsp;2/2</span>
        <div class="">
       <div class="nav-buttons">
  <div class="icon-btn" (click)="prevDoc()">
    <img src="/sidebar/Preicon.png" alt="Previous">
  </div>
  <div class="icon-btn" 
       (click)="nextDoc()" 
       [class.disabled]="currentDoc === 2">
    <img src="/sidebar/Next Icon.png" alt="Next">
  </div>
</div>

        </div>
      </div>
    </div>
  </div>

  <!-- ✅ Reuse Approve/Reject buttons -->
  <div class="review-actions mt-3">
    <button class="reject-btn">Reject application</button>
    <button class="approve-btn">Approve application</button>
  </div>




    </div>




  </div>